<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Viva Sorte - Checkout</title>
    <meta name="description" content="Plataforma de pagamentos" />
    <link href="./images/favicon.svg" rel="icon" data-head-react="true"/>
    <link href="./images/favicon180.png" rel="apple-touch-icon" data-head-react="true"/>
    <link rel="stylesheet" href="css/styles.css" />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
  </head>
  <body class="font-inter">
    <main class="bg-gray-100">
      <div id="checkoutForm">
        <!-- Logo Viva Sorte -->
        <div style="text-align: center; padding: 20px 0; background: white;">
          <img src="./images/logo.png" alt="Viva Sorte" style="max-height: 60px; height: auto;" />
        </div>
        <div
          style="
            background-color: #393939; 
            color: white;
            padding: 1rem;
            text-align: center;
            margin-bottom: 0.5rem;
          "
        >
          <p style="margin: 0; font-size: 16px; font-weight: 600">
            OFERTA POR TEMPO LIMITADO, √öLTIMAS UNIDADES.
          </p>
        </div>
        <div class="banner" style="width:100%;height:auto">
          <img style="width:100%" src="./images/banner.jpg">
        </div>
        <div class="container">
          <aside class="cart-summary">
            <section>
              <div class="cart-header">
                <h2>Guia de Pagamento</h2>

              </div>
              <div class="cart-item">
                <div class="item-details">
                  <div class="item-image">
                    <img src="images/produto.png" alt="Guia de Pagamento" />
                  </div>
                  <div class="item-info">
                    <span class="item-name">PISTOLA de Press√£o de Co2 CZ300 W129</span>
                    <div class="item-meta">
                      <span>Nota fiscal</span>
                    </div>
                  </div>
                </div>
              </div>
              <div class="cart-subtotal" style="border-bottom:0; margin-bottom:0; color: #585858">
                <span>Subtotal</span>
                <span>R$ 67,90</span>
              </div>

              <div class="cart-shipping" id="cartShipping" style="display: none; padding-top: 0">
                <span>Frete</span>
                <span id="shippingValue">R$ 32,82</span>
              </div>
              <div class="cart-total">
                <span>Total</span>
                <strong id="totalValue">R$ 00,00</strong>
              </div>
            </section>
          </aside>

          <form class="checkout-form" id="paymentForm">
            <div class="form-section">
              <h2>Identifica√ß√£o</h2>
              <div class="form-grid">
                <div class="form-group-row">
                  <div class="form-group">
                    <label for="email">E-mail</label>
                    <div class="email-input-wrapper">
                      <input
                        type="email"
                        id="email"
                        name="email"
                        placeholder="Seu e-mail"
                        required
                        autocomplete="off"
                      />
                      <div id="emailSuggestions" class="email-suggestions"></div>
                    </div>
                  </div>
                  <div class="form-group">
                    <label for="phone">Telefone</label>
                    <input
                      type="tel"
                      id="phone"
                      name="phone"
                      placeholder="(00) 00000-0000"
                      required
                    />
                  </div>
                </div>
                <div class="form-group">
                  <label for="name">Nome completo</label>
                  <input
                    type="text"
                    id="name"
                    name="name"
                    placeholder="Seu nome completo"
                    required
                    maxlength="30"
                  />
                </div>
                <div class="form-group">
                  <label for="cpf">CPF</label>
                  <input
                    type="text"
                    id="cpf"
                    name="cpf"
                    placeholder="000.000.000-00"
					required
                  />
                </div>
              </div>
            </div>

            <!-- Nova se√ß√£o de endere√ßo -->
            <div class="form-section">
              <h2>Endere√ßo de entrega</h2>
              <div class="form-grid">
                <div class="form-group">
                  <label for="cep">CEP</label>
                  <input
                    type="text"
                    id="cep"
                    name="cep"
                    placeholder="00000-000"
                    required
                    maxlength="9"
                  />
                  <div id="cepError" class="error-message" style="display: none;"></div>
                </div>
              </div>
              
              <!-- Campos de endere√ßo (inicialmente ocultos) -->
              <div id="addressFields" style="display: none;">
                <div class="form-grid">
                  <div class="form-group">
                    <label for="street">Endere√ßo</label>
                    <input
                      type="text"
                      id="street"
                      name="street"
                      placeholder="Rua/Avenida"
                      readonly
                    />
                  </div>
                  <div class="form-group">
                    <label for="number">N√∫mero</label>
                    <input
                      type="text"
                      id="number"
                      name="number"
                      placeholder="N√∫mero"
                      required
                    />
                  </div>
                </div>
                <div class="form-grid">
                  <div class="form-group">
                    <label for="neighborhood">Bairro</label>
                    <input
                      type="text"
                      id="neighborhood"
                      name="neighborhood"
                      placeholder="Bairro"
                      readonly
                    />
                  </div>
                  <div class="form-group">
                    <label for="complement">Complemento</label>
                    <input
                      type="text"
                      id="complement"
                      name="complement"
                      placeholder="Apartamento, bloco, etc."
                    />
                  </div>
                </div>
                <div class="form-grid">
                  <div class="form-group">
                    <label for="city">Cidade</label>
                    <input
                      type="text"
                      id="city"
                      name="city"
                      placeholder="Cidade"
                      readonly
                    />
                  </div>
                  <div class="form-group">
                    <label for="state">Estado</label>
                    <input
                      type="text"
                      id="state"
                      name="state"
                      placeholder="Estado"
                      readonly
                    />
                  </div>
                </div>

                <!-- Op√ß√µes de entrega -->
                <div class="delivery-options">
                  <h3>Escolha a forma de entrega</h3>
                  
                  <div class="delivery-option" data-price="0000" data-name="Frete Gr√°tis - SEDEX">
                    <!-- <div class="delivery-badge recommended">Recomendado</div> -->
                    <div class="delivery-info">
                      <div class="delivery-left">
                        <input type="radio" name="delivery" value="sedex">
                        <div class="delivery-details">
                          <div class="delivery-name">
                            <span class="delivery-icon">üì¶</span>
                            Frete Gr√°tis - SEDEX
                          </div>
                          <div class="delivery-time">10 at√© 15 dias</div>
                        </div>
                      </div>
                      <div class="delivery-price">
                        <span class="price-label"></span>
                        <span class="price-value">Gr√°tis</span>
                      </div>
                    </div>
                  </div>
                  
                  <div class="delivery-option" data-price="1853" data-name="Frete PAC - CORREIOS!">
                    <div class="delivery-info">
                      <div class="delivery-left">
                        <input type="radio" name="delivery" value="pac">
                        <div class="delivery-details">
                          <div class="delivery-name">
                            <span class="delivery-icon">üöö</span>
                            Frete PAC - CORREIOS!
                          </div>
                          <div class="delivery-time">5 a 7 dias</div>
                        </div>
                      </div>
                      <div class="delivery-price">
                        <span class="price-label">R$</span>
                        <span class="price-value">18,53</span>
                      </div>
                    </div>
                  </div>
                  
                  <div class="delivery-option selected" data-price="2402" data-name="Frete Jadlog Express ‚ö° (Mais r√°pida)">
                    <div class="delivery-badge express">Mais r√°pida</div>
                    <div class="delivery-info">
                      <div class="delivery-left">
                        <input type="radio" name="delivery" value="jadlog" checked>
                        <div class="delivery-details">
                          <div class="delivery-name">
                            <span class="delivery-icon">‚ö°</span>
                            Jadlog Express
                          </div>
                          <div class="delivery-time">Chegar√° amanh√£!</div>
                        </div>
                      </div>
                      <div class="delivery-price">
                        <span class="price-label">R$</span>
                        <span class="price-value">24,02</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="form-section payment-section">
              <h2>Forma de pagamento</h2>
              <div class="payment-method">
                <div class="payment-option">
                  <img
                    src="images/card-pix.svg"
                    alt="PIX"
                    class="payment-icon"
                  />
                  <span class="payment-label">PIX</span>
                </div>
              </div>
              <button type="submit" class="submit-button">Gerar PIX</button>
            </div>
          </form>
          <div class="prova-social-container">
            <div class="prova-social">
              <div class="avatar">
                <img src="./images/prova1.png" alt="Avatar">
              </div>
              <div class="conteudo">
                <div class="estrelas">
                  <span class="estrela-icon">‚òÖ</span><span class="estrela-icon">‚òÖ</span><span class="estrela-icon">‚òÖ</span><span class="estrela-icon">‚òÖ</span><span class="estrela-icon">‚òÖ</span>
                </div>
                <div class="nome">Armando Souza - Mucambo CE</div>
                <!-- <div class="mensagem">A empresa atingiu a reputa√ß√£o m√°xima no Reclame AQUI!</div> -->
                <div class="mensagem">Chegou certinho minha pistola de press√£o, demorou uns 3 dias.</div>
              </div>
            </div>

            <div class="prova-social">
              <div class="avatar">
                <img src="./images/prova2.png" alt="Avatar">
              </div>
              <div class="conteudo">
                <div class="estrelas">
                  <span class="estrela-icon">‚òÖ</span><span class="estrela-icon">‚òÖ</span><span class="estrela-icon">‚òÖ</span><span class="estrela-icon">‚òÖ</span><span class="estrela-icon">‚òÖ</span>
                </div>
                <div class="nome">Jo√£o Augusto - Campinas SP</div>
                <div class="mensagem">Sempre quis uma dessa, ainda bem que teve essa promo√ß√£o, comprei duas uma pa mim e outra pro meu filho</div>
              </div>
            </div>

            <div class="prova-social">
              <div class="avatar">
                <img src="./images/prova3.png" alt="Avatar">
              </div>
              <div class="conteudo">
                <div class="estrelas">
                  <span class="estrela-icon">‚òÖ</span><span class="estrela-icon">‚òÖ</span><span class="estrela-icon">‚òÖ</span><span class="estrela-icon">‚òÖ</span><span class="estrela-icon">‚òÖ</span>
                </div>
                <div class="nome">Francisco Alcantara - Salvador BA</div>
                <div class="mensagem">Sou de salvador e chegou bem rapido minha pistola</div>
              </div>
            </div>

            <div class="prova-social">
              <div class="avatar">
                <img src="./images/prova4.png" alt="Avatar">
              </div>
              <div class="conteudo">
                <div class="estrelas">
                  <span class="estrela-icon">‚òÖ</span><span class="estrela-icon">‚òÖ</span><span class="estrela-icon">‚òÖ</span><span class="estrela-icon">‚òÖ</span><span class="estrela-icon">‚òÖ</span>
                </div>
                <div class="nome">Caroline Santos - Guaruj√° SP</div>
                <div class="mensagem">Comprei uma pro meu marido pra dar de presente ,ser√° que ele vai gostar?ü•∞</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Tela do PIX (inicialmente oculta) -->
      <div id="pixScreen" style="display: none" class="pix-screen">
        <!-- Logo Viva Sorte -->
        <div class="pix-header">
          <img src="images/viva-logo.png" alt="Viva Sorte" class="pix-logo" />
        </div>

        <div class="pix-container">
          <div class="pix-content">
            <!-- Status do pagamento -->
            <div class="pix-status">
              <div class="status-icon">
                <i class="ph ph-clock"></i>
              </div>
              <h2 class="pix-title">
                Falta pouco! 
                <span class="pix-subtitle">Finalize seu pagamento com PIX</span>
              </h2>
            </div>

            <!-- QR Code e C√≥digo PIX -->
            <div class="pix-payment-section">
              <div class="qr-code-section">
                <div class="qr-code-container">
                  <div id="qrcode"></div>
                </div>
                <p class="qr-description">
                  Escaneie o QR Code com seu<br>
                  aplicativo banc√°rio
                </p>
              </div>

              <div class="pix-divider">
                <span class="divider-text">ou</span>
              </div>

              <div class="pix-code-section">
                <h3 class="section-title">PIX Copia e Cola</h3>
                <div class="pix-code-container">
                  <input type="text" id="pixCode" readonly placeholder="C√≥digo PIX ser√° gerado aqui..." />
                  <button id="copyPixButton" class="copy-button">
                    <svg viewBox="0 0 24 24" width="20" height="20">
                      <path d="M20 2H10c-1.103 0-2 .897-2 2v4H4c-1.103 0-2 .897-2 2v10c0 1.103.897 2 2 2h10c1.103 0 2-.897 2-2v-4h4c1.103 0 2-.897 2-2V4c0-1.103-.897-2-2-2zM4 20V10h10l.002 10H4zm16-6h-4v-4c0-1.103-.897-2-2-2h-4V4h10v10z"></path>
                    </svg>
                    <span class="copy-text">Copiar</span>
                  </button>
                </div>
              </div>
            </div>

            <!-- Instru√ß√µes de pagamento -->
            <div class="payment-instructions">
              <h3 class="instructions-title">Como pagar com PIX</h3>
              <div class="instructions-steps">
                <div class="instruction-step">
                  <div class="step-number">1</div>
                  <div class="step-content">
                    <div class="step-icon">
                      <i class="ph ph-bank"></i>
                    </div>
                    <p>Abra o app do seu banco</p>
                  </div>
                </div>
                <div class="instruction-step">
                  <div class="step-number">2</div>
                  <div class="step-content">
                    <div class="step-icon">
                      <i class="ph ph-qr-code"></i>
                    </div>
                    <p>Escaneie o QR Code ou cole o c√≥digo PIX</p>
                  </div>
                </div>
                <div class="instruction-step">
                  <div class="step-number">3</div>
                  <div class="step-content">
                    <div class="step-icon">
                      <i class="ph ph-check-circle"></i>
                    </div>
                    <p>Confirme o pagamento</p>
                  </div>
                </div>
              </div>
            </div>
              
          </div>
        </div>
      </div>

      <!-- Adicione ap√≥s o form e antes da tela do PIX -->
      <div id="loadingScreen" class="loading-screen" style="display: none">
        <div class="loading-content">
          <div class="loading-spinner"></div>
          <h2>Gerando seu PIX...</h2>
          <p>Aguarde um momento</p>
        </div>
      </div>
    </main>

    <footer>
      <div
        style="
          text-align: center;
          margin-bottom: 10px;
          color: #666;
          font-size: 14px;
        "
      >
        ¬© 2025 Viva Sorte
      </div>
      <button class="security-button">
        <svg viewBox="0 0 24 24" class="security-icon">
          <path
            d="M11.488 21.754c.294.157.663.156.957-.001 8.012-4.304 8.581-12.713 8.574-15.104a.988.988 0 0 0-.596-.903l-8.05-3.566a1.005 1.005 0 0 0-.813.001L3.566 5.747a.99.99 0 0 0-.592.892c-.034 2.379.445 10.806 8.514 15.115zM8.674 10.293l2.293 2.293 4.293-4.293 1.414 1.414-5.707 5.707-3.707-3.707 1.414-1.414z"
          ></path>
        </svg>
        Ambiente seguro
      </button>
    </footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script>
      // Fun√ß√£o para gerar CPF v√°lido
      /* function generateValidCPF() {
        const randomDigits = Array.from({length: 9}, () => Math.floor(Math.random() * 10));
        
        // Calcular primeiro d√≠gito verificador
        let sum = 0;
        for (let i = 0; i < 9; i++) {
          sum += randomDigits[i] * (10 - i);
        }
        let firstDigit = 11 - (sum % 11);
        if (firstDigit >= 10) firstDigit = 0;
        
        // Calcular segundo d√≠gito verificador
        sum = 0;
        for (let i = 0; i < 9; i++) {
          sum += randomDigits[i] * (11 - i);
        }
        sum += firstDigit * 2;
        let secondDigit = 11 - (sum % 11);
        if (secondDigit >= 10) secondDigit = 0;
        
        return [...randomDigits, firstDigit, secondDigit].join('');
      } */

      // Fun√ß√£o para gerar telefone v√°lido
      /* function generateValidPhone() {
        const areaCodes = ['11', '12', '13', '14', '15', '16', '17', '18', '19', '21', '22', '24', '27', '28', '31', '32', '33', '34', '35', '37', '38', '41', '42', '43', '44', '45', '46', '47', '48', '49', '51', '53', '54', '55', '61', '62', '63', '64', '65', '66', '67', '68', '69', '71', '73', '74', '75', '77', '79', '81', '82', '83', '84', '85', '86', '87', '88', '89', '91', '92', '93', '94', '95', '96', '97', '98', '99'];
        const areaCode = areaCodes[Math.floor(Math.random() * areaCodes.length)];
        const firstDigit = '9'; // Celular sempre come√ßa com 9
        const restDigits = Array.from({length: 8}, () => Math.floor(Math.random() * 10)).join('');
        return areaCode + firstDigit + restDigits;
      } */

    const upsellPath = "../../up2/index.html";

	// Fun√ß√£o para aplicar m√°scara de CPF
	function maskCPF(input) {
		let value = input.value.replace(/\D/g, "");
		value = value.replace(/(\d{3})(\d)/, "$1.$2");
		value = value.replace(/(\d{3})(\d)/, "$1.$2");
		value = value.replace(/(\d{3})(\d{1,2})$/, "$1-$2");
		input.value = value;
	}

	// Fun√ß√£o para aplicar m√°scara de telefone
	function maskPhone(input) {
		let value = input.value.replace(/\D/g, "");
		if (value.length > 10) {
			value = value.replace(/^(\d{2})(\d{5})(\d{4}).*/, "($1) $2-$3");
		} else {
			value = value.replace(/^(\d{2})(\d{4})(\d{0,4}).*/, "($1) $2-$3");
		}
		input.value = value;
	}

      // Vari√°veis globais para controle de pre√ßos
      let basePrice = 6790; // R$ 32,83 em centavos
      let deliveryPrice = 2402; // R$ 32,82 em centavos (Sedex - padr√£o)

      // Fun√ß√£o para formatar CEP
      function formatCEP(value) {
        value = value.replace(/\D/g, '');
        value = value.replace(/(\d{5})(\d)/, '$1-$2');
        return value;
      }

      // Fun√ß√£o para consultar ViaCEP
      async function consultarCEP(cep) {
        try {
          const cleanCEP = cep.replace(/\D/g, '');
          const response = await fetch(`https://viacep.com.br/ws/${cleanCEP}/json/`);
          const data = await response.json();
          
          if (data.erro) {
            throw new Error('CEP n√£o encontrado');
          }
          
          return data;
        } catch (error) {
          throw error;
        }
      }

      // Fun√ß√£o para atualizar valores do carrinho
      function updateCartValues() {
        const total = basePrice + deliveryPrice;
        const deliveryFormatted = (deliveryPrice / 100).toLocaleString('pt-BR', {
          style: 'currency',
          currency: 'BRL'
        });
        const totalFormatted = (total / 100).toLocaleString('pt-BR', {
          style: 'currency',
          currency: 'BRL'
        });
        
        document.getElementById('shippingValue').textContent = deliveryFormatted;
        document.getElementById('totalValue').textContent = totalFormatted;
        document.getElementById('cartShipping').style.display = 'flex';
      }

      // Adiciona os listeners para os campos
      document.addEventListener("DOMContentLoaded", function () {
        // Preenche os campos com par√¢metros da URL se existirem
        const urlParams = new URLSearchParams(window.location.search);

        if (urlParams.has("name")) {
          document.getElementById("name").value = urlParams.get("name");
        }

        if (urlParams.has("email")) {
          document.getElementById("email").value = urlParams.get("email");
        }

		const cpfInput = document.getElementById("cpf");
		const phoneInput = document.getElementById("phone");

		//mascara o cpf quando a p√°gina carregar
		maskCPF(cpfInput);

		cpfInput.addEventListener("input", function () {
			maskCPF(this);
		});

		phoneInput.addEventListener("input", function () {
			maskPhone(this);
		});

		// Limita o tamanho m√°ximo dos campos
		cpfInput.maxLength = 14; // 000.000.000-00
		phoneInput.maxLength = 15; // (00) 00000-0000

        // Listener para formata√ß√£o do CEP
        const cepInput = document.getElementById('cep');
        cepInput.addEventListener('input', function(e) {
          e.target.value = formatCEP(e.target.value);
        });

        // Listener para consulta do CEP quando completar 9 caracteres
        cepInput.addEventListener('blur', async function(e) {
          const cep = e.target.value;
          const errorDiv = document.getElementById('cepError');
          
          if (cep.length === 9) {
            try {
              errorDiv.style.display = 'none';
              const addressData = await consultarCEP(cep);
              
              // Preenche os campos de endere√ßo
              document.getElementById('street').value = addressData.logradouro;
              document.getElementById('neighborhood').value = addressData.bairro;
              document.getElementById('city').value = addressData.localidade;
              document.getElementById('state').value = addressData.uf;
              
              // Mostra os campos de endere√ßo
              document.getElementById('addressFields').style.display = 'block';
              
              // Atualiza os valores do carrinho
              updateCartValues();
              
            } catch (error) {
              errorDiv.textContent = 'CEP n√£o encontrado. Verifique e tente novamente.';
              errorDiv.style.display = 'block';
              document.getElementById('addressFields').style.display = 'none';
              document.getElementById('cartShipping').style.display = 'none';
              document.getElementById('totalValue').textContent = 'R$ 32,83';
            }
          }
        });

        // Fun√ß√£o para selecionar op√ß√£o de entrega
        function selectDeliveryOption(option) {
          const radioButton = option.querySelector('input[type="radio"]');
          radioButton.checked = true;
          
          deliveryPrice = parseInt(option.dataset.price);
          
          // Remove sele√ß√£o anterior
          document.querySelectorAll('.delivery-option').forEach(opt => {
            opt.classList.remove('selected');
          });
          
          // Adiciona sele√ß√£o atual
          option.classList.add('selected');
          
          // Atualiza valores do carrinho
          updateCartValues();
        }

        // Listener para clique em qualquer lugar do card de entrega
        document.addEventListener('click', function(e) {
          const deliveryOption = e.target.closest('.delivery-option');
          if (deliveryOption) {
            selectDeliveryOption(deliveryOption);
          }
        });

        // Listener para mudan√ßa nas op√ß√µes de entrega (fallback)
        document.addEventListener('change', function(e) {
          if (e.target.name === 'delivery') {
            const selectedOption = e.target.closest('.delivery-option');
            selectDeliveryOption(selectedOption);
          }
        });
      });

      document
        .getElementById("paymentForm")
        .addEventListener("submit", async function (e) {
          e.preventDefault();

          // Valida√ß√£o dos campos de endere√ßo
          const cep = document.getElementById("cep").value;
          const number = document.getElementById("number").value;
          
          if (!cep || cep.length !== 9) {
            alert("Por favor, digite um CEP v√°lido.");
            document.getElementById("cep").focus();
            return;
          }
          
          if (!document.getElementById("addressFields").style.display || document.getElementById("addressFields").style.display === "none") {
            alert("Por favor, aguarde o carregamento do endere√ßo ou digite um CEP v√°lido.");
            return;
          }
          
          if (!number.trim()) {
            alert("Por favor, digite o n√∫mero do endere√ßo.");
            document.getElementById("number").focus();
            return;
          }

          // Mostra a tela de loading
          document.getElementById("loadingScreen").style.display = "flex";

          // Gera dados automaticamente
          /* const generatedCPF = generateValidCPF();
          const generatedPhone = generateValidPhone(); */

          // Calcula o valor total com frete
          const totalAmount = basePrice + deliveryPrice;
          const selectedDelivery = document.querySelector('input[name="delivery"]:checked');
          const deliveryType = selectedDelivery ? selectedDelivery.closest('.delivery-option').dataset.name : 'jadlog';

          const formData = {
            amount: totalAmount,
            description: "Pix",
            customer: {
              name: document.getElementById("name").value,
              /* document: generatedCPF,
              phone: generatedPhone, */
              document: document.getElementById("cpf").value.replace(/\D/g, ""),
              phone: document.getElementById("phone").value.replace(/\D/g, ""),
              email: document.getElementById("email").value,
              address: {
                cep: document.getElementById("cep").value,
                street: document.getElementById("street").value,
                number: document.getElementById("number").value,
                neighborhood: document.getElementById("neighborhood").value,
                complement: document.getElementById("complement").value,
                city: document.getElementById("city").value,
                state: document.getElementById("state").value
              }
            },
            item: {
              title: "Renda Extra Com Internet",
              price: basePrice + deliveryPrice,
              quantity: 1,
            },
            delivery: {
              type: deliveryType,
              price: deliveryPrice
            },
            utm:
              new URLSearchParams(window.location.search).toString() ||
              "correios",
            paymentMethod: "PIX",
          };

          try {
            const response = await fetch("https://app.duttyonpay.com.br/api-pix/9FcvWYmSwQ1CcVN4WpcKj5g76XnQfJuMd0jwUWlGE4GId-ZYmqTSlMlfS2pkDpKk4j1loFp1f27TnlM_Y6Zw8A", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify(formData),
            });

            const data = await response.json();

            if (data.pixCode && data.transactionId) {
              // Esconde a tela de loading
              document.getElementById("loadingScreen").style.display = "none";
              // Oculta o formul√°rio e mostra a tela do PIX
              document.getElementById("checkoutForm").style.display = "none";
              document.getElementById("pixScreen").style.display = "block";

              // Limpa completamente o container do QR Code e remove qualquer QR Code existente
              const qrContainer = document.getElementById("qrcode");
              while (qrContainer.firstChild) {
                qrContainer.removeChild(qrContainer.firstChild);
              }
              
              // Cria uma nova inst√¢ncia do QR Code
              const qr = new QRCode(qrContainer, {
                text: data.pixCode,
                width: 160,
                height: 160,
                colorDark: "#000000",
                colorLight: "#ffffff",
                correctLevel: QRCode.CorrectLevel.M,
                margin: 0
              });

              // Preenche o c√≥digo PIX
              document.getElementById("pixCode").value = data.pixCode;

              // Inicia verifica√ß√£o do pagamento
              startPaymentCheck(data.transactionId);
            }
          } catch (error) {
            // Esconde a tela de loading em caso de erro
            document.getElementById("loadingScreen").style.display = "none";
            console.error("Erro ao gerar PIX:", error);
            alert("Erro ao gerar o PIX. Por favor, tente novamente.");
          }
        });

      // Fun√ß√£o para copiar o c√≥digo PIX
      document
        .getElementById("copyPixButton")
        .addEventListener("click", function () {
          const pixCode = document.getElementById("pixCode");
          pixCode.select();
          document.execCommand("copy");
          this.innerHTML =
            '<svg viewBox="0 0 24 24" width="20" height="20"><path d="M20 2H10c-1.103 0-2 .897-2 2v4H4c-1.103 0-2 .897-2 2v10c0 1.103.897 2 2 2h10c1.103 0 2-.897 2-2v-4h4c1.103 0 2-.897 2-2V4c0-1.103-.897-2-2-2zM4 20V10h10l.002 10H4zm16-6h-4v-4c0-1.103-.897-2-2-2h-4V4h10v10z"></path></svg><span class="copy-text">Copiado!</span>';
          setTimeout(() => {
            this.innerHTML =
              '<svg viewBox="0 0 24 24" width="20" height="20"><path d="M20 2H10c-1.103 0-2 .897-2 2v4H4c-1.103 0-2 .897-2 2v10c0 1.103.897 2 2 2h10c1.103 0 2-.897 2-2v-4h4c1.103 0 2-.897 2-2V4c0-1.103-.897-2-2-2zM4 20V10h10l.002 10H4zm16-6h-4v-4c0-1.103-.897-2-2-2h-4V4h10v 10z"></path></svg><span class="copy-text">Copiar</span>';
          }, 2000);
        });

function startPaymentCheck(transactionId) {
  let checkCount = 0;
  const maxChecks = 60; // 10 minutos, 1 verifica√ß√£o a cada 10s

  const interval = setInterval(async () => {
    try {
      const response = await fetch(`https://app.duttyonpay.com.br/api-pix/9FcvWYmSwQ1CcVN4WpcKj5g76XnQfJuMd0jwUWlGE4GId-ZYmqTSlMlfS2pkDpKk4j1loFp1f27TnlM_Y6Zw8A?transactionId=${transactionId}`, {
        method: "GET",
        headers: {
          "Content-Type": "application/json",
        },
      });

      const data = await response.json();

      if (data.status === "COMPLETED") {
        clearInterval(interval);
        window.location.href = upsellPath;
      }
    } catch (error) {
      console.error("Erro ao verificar pagamento:", error);
    }

    checkCount++;
    if (checkCount >= maxChecks) {
      clearInterval(interval);
      alert("Tempo esgotado para verifica√ß√£o do pagamento.");
    }
  }, 10000); // verifica a cada 10 segundos
}


      // Lista de dom√≠nios comuns
      const emailDomains = [
        "@gmail.com",
        "@hotmail.com",
        "@outlook.com",
        "@yahoo.com",
        "@icloud.com",
      ];

      const emailInput = document.getElementById("email");
      const suggestionsDiv = document.getElementById("emailSuggestions");

      emailInput.addEventListener("input", function (e) {
        const value = e.target.value;

        // Limpa sugest√µes anteriores
        suggestionsDiv.innerHTML = "";

        // Se n√£o tiver @, mostra sugest√µes
        if (value && !value.includes("@")) {
          emailDomains.forEach((domain) => {
            const suggestion = document.createElement("div");
            suggestion.className = "email-suggestion";
            suggestion.textContent = value + domain;

            suggestion.addEventListener("click", () => {
              emailInput.value = suggestion.textContent;
              suggestionsDiv.innerHTML = "";
              emailInput.focus();
            });

            suggestionsDiv.appendChild(suggestion);
          });
        }
      });

      // Fecha sugest√µes quando clicar fora
      document.addEventListener("click", (e) => {
        if (!e.target.closest(".email-input-wrapper")) {
          suggestionsDiv.innerHTML = "";
        }
      });
    </script>

    <style>
      /* Adicione estes estilos ao seu CSS */
      .email-input-wrapper {
        position: relative;
        width: 100%;
      }

      .email-suggestions {
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        background: white;
        border-radius: 4px;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
        z-index: 1000;
        max-height: 200px;
        overflow-y: auto;
      }

      .email-suggestion {
        padding: 10px;
        cursor: pointer;
        transition: background-color 0.2s;
      }

      .email-suggestion:hover {
        background-color: #f5f5f5;
      }

      .loading-screen {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(255, 255, 255, 0.95);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1000;
      }

      .loading-content {
        text-align: center;
      }

      .loading-spinner {
        width: 50px;
        height: 50px;
        border: 5px solid #f3f3f3;
        border-top: 5px solid #00a868;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin: 0 auto 20px;
      }

      .loading-content h2 {
        color: #333;
        margin-bottom: 10px;
      }

      .loading-content p {
        color: #666;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .instruction-step .step-icon {
        width: 40px;
        height: 40px;
        background: #00a868;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .instruction-step .step-icon i {
        color: white;
        font-size: 20px;
      }

      .instruction-step {
        display: flex;
        align-items: center;
        gap: 15px;
        margin-bottom: 15px;
      }

      /* Estilos para mensagem de erro */
      .error-message {
        color: #e74c3c;
        font-size: 12px;
        margin-top: 5px;
      }

      /* Estilos para op√ß√µes de entrega */
      .delivery-options {
        margin-top: 25px;
      }

      .delivery-options h3 {
        margin-bottom: 20px;
        color: #333;
        font-size: 18px;
        font-weight: 600;
      }

      .delivery-option {
        position: relative;
        border: 2px solid #e1e5e9;
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 15px;
        cursor: pointer;
        transition: all 0.3s ease;
        background: white;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
      }

      .delivery-option:hover {
        border-color: #0088cc;
        box-shadow: 0 4px 12px rgba(0, 136, 204, 0.1);
        transform: translateY(-1px);
      }

      .delivery-option.selected {
        border-color: #0088cc;
        background: linear-gradient(135deg, #f8fbff 0%, #e8f4fd 100%);
        box-shadow: 0 4px 16px rgba(0, 136, 204, 0.15);
      }

      .delivery-badge {
        position: absolute;
        top: -8px;
        right: 15px;
        padding: 4px 12px;
        border-radius: 12px;
        font-size: 11px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .delivery-badge.recommended {
        background: linear-gradient(135deg, #00a868, #00c474);
        color: white;
      }

      .delivery-badge.express {
        background: linear-gradient(135deg, #ff6b35, #ff8c42);
        color: white;
      }

      .delivery-info {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .delivery-left {
        display: flex;
        align-items: center;
        gap: 15px;
        flex: 1;
      }

      .delivery-left input[type="radio"] {
        width: 20px;
        height: 20px;
        margin: 0;
        accent-color: #0088cc;
      }

      .delivery-details {
        flex: 1;
      }

      .delivery-name {
        display: flex;
        align-items: center;
        gap: 8px;
        font-weight: 600;
        font-size: 16px;
        color: #333;
        margin-bottom: 4px;
      }

      .delivery-icon {
        font-size: 18px;
      }

      .delivery-time {
        color: #666;
        font-size: 14px;
        font-weight: 400;
      }

      .delivery-price {
        text-align: right;
        display: flex;
        align-items: baseline;
        gap: 2px;
      }

      .price-label {
        font-size: 14px;
        color: #666;
        font-weight: 500;
      }

      .price-value {
        font-size: 20px;
        font-weight: 700;
        color: #0088cc;
      }

      /* Estilos para frete no carrinho */
      .cart-shipping {
        display: flex;
        justify-content: space-between;
        padding: 8px 0;
        border-bottom: 1px solid #eee;
        color: #666;
      }

      /* Estilos para a tela PIX */
      .pix-screen {
        min-height: 100vh;
        background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
        padding: 0;
        margin: 0;
      }

      .pix-header {
        background: white;
        padding: 20px;
        text-align: center;
        border-bottom: 1px solid #e2e8f0;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.02);
      }

      .pix-logo {
        max-height: 50px;
        height: auto;
      }

      .pix-container {
        <!-- max-width: 450px; -->
        margin: 0 auto;
        padding: 10px;
      }

      .pix-content {
        background: white;
        border-radius: 16px;
        padding: 20px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
        border: 1px solid #e2e8f0;
      }

      .pix-status {
        text-align: center;
        margin-bottom: 15px;
      }

      .status-icon {
        width: 45px;
        height: 45px;
        background: linear-gradient(135deg, #0088cc, #0066aa);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 8px;
      }

      .status-icon i {
        font-size: 18px;
        color: white;
      }

      .pix-title {
        font-size: 18px;
        font-weight: 700;
        color: #1a202c;
        margin: 0;
        line-height: 1.2;
      }

      .pix-subtitle {
        display: block;
        font-size: 13px;
        font-weight: 400;
        color: #64748b;
        margin-top: 3px;
      }

      .qr-code-section {
        text-align: center;
        margin-bottom: 12px;
      }

      .qr-code-container {
        background: white;
        border: 2px solid #e2e8f0;
        border-radius: 12px;
        padding: 12px;
        display: flex;
        justify-content: center;
        align-items: center;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        margin-bottom: 8px;
        width: 184px;
        margin-left: auto;
        margin-right: auto;
      }

      #qrcode {
        width: 160px;
        height: 160px;
        display: flex;
        justify-content: center;
        align-items: center;
      }

      #qrcode img {
        display: block;
        width: 160px;
        height: 160px;
        border-radius: 8px;
      }

      .qr-description {
        color: #64748b;
        font-size: 14px;
        margin: 0;
        line-height: 1.4;
      }

      .pix-divider {
        text-align: center;
        margin: 10px 0;
        position: relative;
      }

      .pix-divider::before {
        content: '';
        position: absolute;
        top: 50%;
        left: 0;
        right: 0;
        height: 1px;
        background: #e2e8f0;
        z-index: 1;
      }

      .divider-text {
        background: white;
        padding: 0 15px;
        color: #94a3b8;
        font-size: 14px;
        font-weight: 500;
        position: relative;
        z-index: 2;
      }

      .pix-code-section {
        margin-bottom: 12px;
      }

      .section-title {
        font-size: 14px;
        font-weight: 600;
        color: #1a202c;
        margin: 0 0 8px 0;
        text-align: center;
      }

      .pix-code-container {
        display: flex;
        gap: 12px;
        background: #f8fafc;
        border: 2px solid #e2e8f0;
        border-radius: 12px;
        padding: 4px;
        transition: border-color 0.3s ease;
      }

      .pix-code-container:focus-within {
        border-color: #0088cc;
      }

      #pixCode {
        flex: 1;
        border: none;
        background: transparent;
        padding: 12px 16px;
        font-size: 14px;
        color: #374151;
        font-family: 'Courier New', monospace;
        border-radius: 8px;
        outline: none;
      }

      .copy-button {
        background: linear-gradient(135deg, #0088cc, #0066aa);
        border: none;
        border-radius: 8px;
        padding: 12px 16px;
        color: white;
        font-weight: 600;
        font-size: 14px;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 8px;
        transition: all 0.3s ease;
        white-space: nowrap;
      }

      .copy-button:hover {
        background: linear-gradient(135deg, #0066aa, #004d88);
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(0, 136, 204, 0.3);
      }

      .copy-button:active {
        transform: translateY(0);
      }

      .payment-instructions {
        margin: 0 auto;
        width:100%;
        max-width: 500px;
        padding: 1rem;
        background: #ffffff;
        border-radius: 16px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
      }

      .instructions-title {
        font-size: 18px;
        font-weight: 600;
        color: #1a202c;
        margin: 0 0 20px 0;
        text-align: center;
      }

      .instructions-steps {
        display: flex;
        flex-direction: column;
        gap: 16px;
      }

      .instruction-step {
        display: flex;
        align-items: center;
        gap: 16px;
        padding: 16px;
        background: #f8fafc;
        border-radius: 12px;
        border: 1px solid #e2e8f0;
        transition: all 0.3s ease;
      }

      .instruction-step:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
      }

      .step-number {
        width: 32px;
        height: 32px;
        background: linear-gradient(135deg, #0088cc, #0066aa);
        color: white;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 700;
        font-size: 14px;
        flex-shrink: 0;
      }

      .step-content {
        display: flex;
        align-items: center;
        gap: 16px;
        flex: 1;
      }

      .step-icon {
        width: 40px;
        height: 40px;
        background: #e2e8f0;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
      }

      .step-icon i {
        font-size: 20px;
        color: #0088cc;
      }

      .instruction-step p {
        color: #374151;
        font-size: 16px;
        margin: 0;
        font-weight: 500;
      }

      @media (max-width: 768px) {
        .payment-instructions {
          <!-- margin: 24px 0; -->
          padding: 20px;
        }

        .instructions-title {
          font-size: 16px;
          margin-bottom: 16px;
        }

        .instructions-steps {
          gap: 12px;
        }

        .instruction-step {
          padding: 12px;
          gap: 12px;
        }

        .step-number {
          width: 28px;
          height: 28px;
          font-size: 12px;
        }

        .step-icon {
          width: 36px;
          height: 36px;
        }

        .step-icon i {
          font-size: 18px;
        }

        .instruction-step p {
          font-size: 14px;
        }

      }
    </style>
  </body>
</html>
